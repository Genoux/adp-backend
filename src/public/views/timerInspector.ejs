<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Timer Inspector</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="/socket.io/socket.io.js"></script>
</head>
<body class="bg-gray-100 p-8">
    <h1 class="text-3xl font-bold mb-6">Timer Inspector</h1>
    <div id="timers" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        <% roomStates.forEach(function(room) { %>
            <div class="bg-white p-6 rounded-lg shadow-md" id="room-<%= room.roomId %>">
                <h2 class="text-xl font-semibold mb-4">Room <%= room.roomId %></h2>
                <div class="mb-4">
                    <p class="font-medium">Main Timer: <span class="font-bold main-timer"><%= room.countdownTimer.timeLeft %></span></p>
                    <div class="mt-2">
                        <button onclick="timerAction('reset', <%= room.roomId %>, false)" class="bg-blue-500 text-white px-3 py-1 rounded hover:opacity-80">Reset</button>
                        <button onclick="timerAction('pause', <%= room.roomId %>, false)" class="bg-red-500 text-white px-3 py-1 rounded hover:opacity-80">pause</button>
                        <button onclick="timerAction('start', <%= room.roomId %>, false)" class="bg-green-500 text-white px-3 py-1 rounded hover:opacity-80">Start</button>
                    </div>
                </div>
                <div>
                    <p class="font-medium">Lobby Timer: <span class="font-bold lobby-timer"><%= room.countdownTimerLobby.timeLeft %></span></p>
                    <div class="mt-2">
                        <button onclick="timerAction('reset', <%= room.roomId %>, true)" class="bg-blue-500 text-white px-3 py-1 rounded hover:opacity-80">Reset</button>
                        <button onclick="timerAction('pause', <%= room.roomId %>, true)" class="bg-red-500 text-white px-3 py-1 rounded hover:opacity-80">Stop</button>
                        <button onclick="timerAction('start', <%= room.roomId %>, true)" class="bg-green-500 text-white px-3 py-1 rounded hover:opacity-80">Start</button>
                    </div>
                </div>
            </div>
        <% }); %>
    </div>
    <script>
        const socket = io();

        socket.on('timerUpdate', (data) => {
            console.log(data);
            updateTimers(data.roomStates);
        });

        function updateTimers(roomStates) {
            roomStates.forEach(room => {
                const roomElement = document.getElementById(`room-${room.roomId}`);
                if (roomElement) {
                    roomElement.querySelector('.main-timer').textContent = room.countdownTimer.timeLeft;
                    roomElement.querySelector('.lobby-timer').textContent = room.countdownTimerLobby.timeLeft;
                }
            });
        }

        function timerAction(action, roomId, isLobby) {
            socket.emit('timerAction', { action, roomId, isLobby });
        }
    </script>
</body>
</html>